# Graylog Azure Deployment Project

Welcome to the **Graylog Azure Project Package**! This project automates the deployment of a **Graylog centralized logging system** on Azure, optimized with spot VMs, Azure File Share for log storage, automated blob backups, and Application Gateway integration.

---

## Project Structure

```
/terraform
  - main.tf
  - variables.tf
  - outputs.tf
  - storage.tf
  - monitoring.tf

/cloud-init
  - cloud-init-graylog.yaml
  - cloud-init-mongodb.yaml

/cost
  - Graylog_Azure_Cost_Estimate.xlsx

/diagrams
  - architecture_diagram.png
```

---

## Components

### Terraform Modules:

- **main.tf**: Core infrastructure (VMs, NICs, VNet, Subnets)
- **variables.tf**: Input variables
- **outputs.tf**: Outputs for IPs, storage keys, etc.
- **storage.tf**: Azure File Share creation (512 GiB quota)
- **monitoring.tf**: Azure Monitor alert for 80% File Share usage

### Cloud-Init Scripts:

- **cloud-init-graylog.yaml**: Sets up Graylog Server, mounts File Share, configures logging, installs AzCopy, schedules backup.
- **cloud-init-mongodb.yaml**: Prepares MongoDB/OpenSearch backend (placeholder for further expansion).

### Cost Estimate:

- **Graylog_Azure_Cost_Estimate.xlsx**: Estimated ~$73/month based on spot VMs and Azure Storage pricing.

### Diagrams:

- **architecture_diagram.png**: Visual of the full Azure deployment architecture.

---

## Deployment Instructions

### 1. Customize Variables

Update `variables.tf` to reflect your:

- Resource Group
- Region
- Storage Account details
- VM sizes if needed

### 2. Initialize Terraform

```bash
cd terraform
terraform init
```

### 3. Plan Deployment

```bash
terraform plan
```

Review and verify what will be created.

### 4. Apply Deployment

```bash
terraform apply
```

Type `yes` to approve.

### 5. (Optional) Adjust `cloud-init`

You may adjust the `cloud-init-graylog.yaml` for:

- SAS token rotation
- Backup script customization

---

## Backup Strategy

- **Daily AzCopy Sync**: From mounted Azure File Share to Blob Storage.
- **7-Day Retention**: Automatic deletion of blobs older than 7 days via lifecycle policy.

---

## Monitoring and Alerts

- Azure Monitor triggers an alert if the file share exceeds **80% capacity**.
- Alert can be configured to send emails, SMS, or webhook actions.

---

## Future Enhancements

- Horizontal scaling of Graylog nodes
- SSL/TLS termination at Application Gateway
- Private Endpoints for Storage Account
- Automatic backup failure notification system

---

## Authors & Support

This package was generated by **ChatGPT, 2025**, with requirements as specified by Rodrigo Murillo.

---

## Final Notes
Replace:

<STORAGE_KEY> with your actual Storage Account Key

<SAS_TOKEN> in backup script

<your_action_group_id_here> in the alert config

Let me know if you'd like:

A terraform.tfvars file for cleaner variable control

Full module separation (network, compute, storage)

GitHub-ready project tree with README updates
